var RoboCrop=function(){this.icons={apply:'<svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 442.533 442.533" xml:space="preserve"><path fill="#fff" d="M434.539,98.499l-38.828-38.828c-5.324-5.328-11.799-7.993-19.41-7.993c-7.618,0-14.093,2.665-19.417,7.993L169.59,247.248   l-83.939-84.225c-5.33-5.33-11.801-7.992-19.412-7.992c-7.616,0-14.087,2.662-19.417,7.992L7.994,201.852   C2.664,207.181,0,213.654,0,221.269c0,7.609,2.664,14.088,7.994,19.416l103.351,103.349l38.831,38.828   c5.327,5.332,11.8,7.994,19.414,7.994c7.611,0,14.084-2.669,19.414-7.994l38.83-38.828L434.539,137.33   c5.325-5.33,7.994-11.802,7.994-19.417C442.537,110.302,439.864,103.829,434.539,98.499z"/></svg>',cancel:'<svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 511.63 511.631" xml:space="preserve"><path fill="#fff" d="M496.5,233.842c-30.841-76.706-114.112-115.06-249.823-115.06h-63.953V45.693c0-4.952-1.809-9.235-5.424-12.85   c-3.617-3.617-7.896-5.426-12.847-5.426c-4.952,0-9.235,1.809-12.85,5.426L5.424,179.021C1.809,182.641,0,186.922,0,191.871   c0,4.948,1.809,9.229,5.424,12.847L151.604,350.9c3.619,3.613,7.902,5.428,12.85,5.428c4.947,0,9.229-1.814,12.847-5.428   c3.616-3.614,5.424-7.898,5.424-12.848v-73.094h63.953c18.649,0,35.349,0.568,50.099,1.708c14.749,1.143,29.413,3.189,43.968,6.143   c14.564,2.95,27.224,6.991,37.979,12.135c10.753,5.144,20.794,11.756,30.122,19.842c9.329,8.094,16.943,17.7,22.847,28.839   c5.896,11.136,10.513,24.311,13.846,39.539c3.326,15.229,4.997,32.456,4.997,51.675c0,10.466-0.479,22.176-1.428,35.118   c0,1.137-0.236,3.375-0.715,6.708c-0.473,3.333-0.712,5.852-0.712,7.562c0,2.851,0.808,5.232,2.423,7.136   c1.622,1.902,3.86,2.851,6.714,2.851c3.046,0,5.708-1.615,7.994-4.853c1.328-1.711,2.561-3.806,3.71-6.283   c1.143-2.471,2.43-5.325,3.854-8.562c1.431-3.237,2.43-5.513,2.998-6.848c24.17-54.238,36.258-97.158,36.258-128.756   C511.63,291.039,506.589,259.344,496.5,233.842z"/></svg>',flip_x:'<svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 444.819 444.819" xml:space="preserve"><path fill="#fff" d="M352.025,196.712L165.884,10.848C159.029,3.615,150.469,0,140.187,0c-10.282,0-18.842,3.619-25.697,10.848L92.792,32.264   c-7.044,7.043-10.566,15.604-10.566,25.692c0,9.897,3.521,18.56,10.566,25.981l138.753,138.473L92.786,361.168   c-7.042,7.043-10.564,15.604-10.564,25.693c0,9.896,3.521,18.562,10.564,25.98l21.7,21.413   c7.043,7.043,15.612,10.564,25.697,10.564c10.089,0,18.656-3.521,25.697-10.564l186.145-185.864   c7.046-7.423,10.571-16.084,10.571-25.981C362.597,212.321,359.071,203.755,352.025,196.712z"/></svg>',flip_y:'<svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 444.819 444.819" xml:space="preserve"><path fill="#fff" d="M433.968,278.657L248.387,92.79c-7.419-7.044-16.08-10.566-25.977-10.566c-10.088,0-18.652,3.521-25.697,10.566   L10.848,278.657C3.615,285.887,0,294.549,0,304.637c0,10.28,3.619,18.843,10.848,25.693l21.411,21.413   c6.854,7.23,15.42,10.852,25.697,10.852c10.278,0,18.842-3.621,25.697-10.852L222.41,213.271L361.168,351.74   c6.848,7.228,15.413,10.852,25.7,10.852c10.082,0,18.747-3.624,25.975-10.852l21.409-21.412   c7.043-7.043,10.567-15.608,10.567-25.693C444.819,294.545,441.205,285.884,433.968,278.657z"/></svg>',crop:'<svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 444.819 444.819" xml:space="preserve"><path fill="#fff" d="M465.948,328.897h-63.953V85.936l70.517-70.233c1.711-1.903,2.566-4.089,2.566-6.565c0-2.478-0.855-4.665-2.566-6.567   C470.609,0.859,468.419,0,465.948,0c-2.478,0-4.668,0.855-6.57,2.57l-70.237,70.521H146.18V9.137c0-2.667-0.855-4.858-2.57-6.567   C141.897,0.859,139.71,0,137.042,0H82.227c-2.665,0-4.858,0.855-6.567,2.57c-1.711,1.713-2.57,3.903-2.57,6.567v63.954H9.136   c-2.666,0-4.856,0.854-6.567,2.568C0.859,77.372,0,79.562,0,82.226v54.818c0,2.666,0.855,4.856,2.568,6.565   c1.714,1.711,3.905,2.57,6.567,2.57h63.954V392.86c0,2.666,0.855,4.856,2.57,6.561c1.713,1.711,3.903,2.573,6.567,2.573h246.678   v63.953c0,2.663,0.855,4.854,2.566,6.564c1.708,1.711,3.898,2.566,6.57,2.566h54.816c2.666,0,4.856-0.855,6.563-2.566   c1.712-1.711,2.574-3.901,2.574-6.564v-63.953h63.953c2.662,0,4.853-0.862,6.56-2.573c1.712-1.704,2.567-3.895,2.567-6.561v-54.819   c0-2.669-0.855-4.863-2.567-6.57C470.801,329.76,468.61,328.897,465.948,328.897z M146.18,146.174h169.881L146.18,316.054V146.174z    M328.904,328.897H159.026l169.878-169.88V328.897z"/></svg>',invert:'<svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 444.819 444.819" xml:space="preserve"><path d="M317.769,368.589c-1.712-2.094-4.09-3.142-7.132-3.142H146.181V255.81h54.814c4.948,0,9.233-1.809,12.847-5.426    c3.616-3.616,5.424-7.898,5.424-12.85c0-4.565-1.431-8.47-4.283-11.704l-91.359-109.636c-3.617-4.184-8.28-6.279-13.99-6.279    c-5.712,0-10.373,2.092-13.988,6.279L4.285,225.83C1.425,229.064,0,232.969,0,237.534c0,4.952,1.811,9.234,5.424,12.85    c3.617,3.617,7.902,5.426,12.85,5.426h54.818v118.775v45.679v3.138v3.714c0,0.574,0.094,1.67,0.284,3.288    c0.191,1.619,0.479,2.714,0.859,3.282c0.378,0.575,0.903,1.335,1.569,2.286c0.662,0.951,1.521,1.622,2.565,1.998    c1.047,0.377,2.334,0.568,3.858,0.568h274.088c2.471,0,4.613-0.903,6.42-2.711c1.807-1.807,2.71-3.948,2.71-6.42    c0-1.909-0.663-3.9-1.995-6.002L317.769,368.589z" fill="#FFFFFF"/><path d="M542.748,297.788c-3.614-3.61-7.898-5.424-12.847-5.424h-54.816V173.593V127.91v-3.14v-3.711    c0-0.572-0.096-1.665-0.288-3.287c-0.191-1.619-0.479-2.712-0.855-3.284c-0.379-0.571-0.903-1.334-1.57-2.284    c-0.667-0.949-1.522-1.617-2.57-1.999c-1.047-0.378-2.327-0.571-3.854-0.571H191.86c-2.474,0-4.611,0.905-6.423,2.712    c-1.805,1.809-2.708,3.951-2.708,6.423c0,2.093,0.662,3.996,1.997,5.71l45.679,54.818c1.713,2.284,4.093,3.426,7.137,3.426    h164.453v109.634h-54.816c-4.948,0-9.232,1.81-12.847,5.42c-3.617,3.621-5.427,7.909-5.427,12.854    c0,4.568,1.43,8.466,4.287,11.707l91.361,109.632c3.806,4.381,8.467,6.567,13.99,6.567c5.514,0,10.174-2.187,13.983-6.567    l91.361-109.632c2.851-3.241,4.284-7.139,4.284-11.707C548.176,305.689,546.361,301.405,542.748,297.788z" fill="#FFFFFF"/></svg>'},this.image={cropped:!1,max_width:2048,max_height:1556,zoom:{speed:10},resolutions:{auto:{w:0,h:0},max:{w:0,h:0},small:{w:0,h:0}}},this.hidePageScroll=!1,this.imageElement=null,this.container,this.event_state={},this.resize_canvas=document.createElement("canvas"),this.orig_src=new Image,this.image_target,this.crop_canvas,this.cropBorder,this.autoSize=!0,this.watermarks={},this.cropValues={enabled:!1,width:{value:200,resize:!1,operator:"=",min:{value:200,operator:">="},max:{value:!1,operator:!1}},height:{value:200,resize:!1,operator:"=",min:{value:200,operator:">="},max:{value:!1,operator:!1}}},this.mouse={},this.width,this.height,this.left,this.top,this.offset,this.touches,this.events={upload:{before:!1,end:!1,progress:!1},apply:null},!$("body #crop-editor").length>0&&$("body").append('<div id="crop-editor"></div>'),$("#crop-editor").append('<div class="editor-busy-container"><div class="editor-busy"></div></div>'),$("#crop-editor").append('<div class="editor-main-menu"></div>'),$("#crop-editor .editor-main-menu").append('<button type="button" class="cancel">'+this.icons.cancel+"</button>").append('<button type="button" class="apply">'+this.icons.apply+"</button>"),$("#crop-editor").append('<div class="image-actions"></div>'),$("#crop-editor .image-actions").append('<button type="button" class="btn-main-menu-action flip-x">'+this.icons.flip_x+"</button>").append('<button type="button" class="btn-main-menu-action flip-y">'+this.icons.flip_y+"</button>").append('<button type="button" class="btn-main-menu-action invert">'+this.icons.invert+"</button>").append('<button type="button" class="btn-main-menu-action crop">'+this.icons.crop+"</button>"),$(".btn-main-menu-action").hide(),$("#crop-editor").append('<div class="image-resolutions"></div>'),$("#crop-editor .image-resolutions").append('<button type="button" class="img-max">max</button>').append('<button type="button" class="img-auto">auto</button>').append('<button type="button" class="img-small">min</button>')};RoboCrop.prototype.busy=function(a){a===!0?$(this.imageElement).find(".loader").length||$(this.imageElement).prepend('<div class="loader"></div>').addClass("busy"):($(this.imageElement).find(".loader").remove(),$(this.imageElement).removeClass("busy"))},RoboCrop.prototype.cropInit=function(){var a=$(robocrop.imageElement).data("crop");if(void 0!==a&&(a=a.split(","),2===a.length)){var b=/\B(\=|\>|\<|\>\=|\<\=)(\d+)/g,c=/\b(\=|\>|\<|\>\=|\<\=)(\d+)/g,d=b.exec(a[0]),e=c.exec(a[0]);b.lastIndex=0,c.lastIndex=0;var f=b.exec(a[1]),g=c.exec(a[1]);null!==d&&(this.cropValues.width.min.value=this.cropValues.width.value=parseInt(d[2]),this.cropValues.width.min.operator=d[1],this.cropValues.width.resize="="!==d[1]),null!==e?(this.cropValues.width.max.value=parseInt(e[2]),this.cropValues.width.max.operator=e[1]):(this.cropValues.width.max.value=!1,this.cropValues.width.max.operator=!1),null!==f&&(this.cropValues.height.min.value=this.cropValues.height.value=parseInt(f[2]),this.cropValues.height.min.operator=f[1],this.cropValues.height.resize="="!==f[1]),null!==g?(this.cropValues.height.max.value=parseInt(g[2]),this.cropValues.height.max.operator=g[1]):(this.cropValues.height.max.value=!1,this.cropValues.height.max.operator=!1)}},RoboCrop.prototype.toggleCrop=function(a){if(this.cropValues.enabled=void 0===a?!this.cropValues.enabled:a===!0&&a,this.cropValues.enabled){this.setCropArea(this.cropValues.width.value,this.cropValues.height.value,this.cropBorder,!0);var b=this;this.crop_area=$("#crop-editor .crop-area"),this.crop_area.on("mousedown touchstart",function(a){b.startMoving(a,b,!0)})}else $("#crop-editor .crop-area").remove()},RoboCrop.prototype.validExtension=function(a,b){if(void 0!==a.type)switch(a.type){case"image/jpg":return!0;case"image/jpeg":return!0;case"image/png":return!0;case"image/bmp":return!0;case"image/gif":return!0;default:return!1}else switch(a){case"jpg":return b===!0||"jpeg";case"jpeg":return b===!0||a;case"png":return b===!0||a;case"bmp":return b===!0||a;case"gif":return b===!0||a;default:return b!==!0&&"png"}},RoboCrop.prototype.init=function(a){this.image.cropped=!1,this.hidePageScroll&&$("html,body,#crop-editor").css("overflow","hidden"),$("#crop-editor .resize-image").length||($("#crop-editor").append('<canvas class="resize-image"></canvas>'),$("#crop-editor .resize-image").wrap('<div class="resize-container"></div>').before('<span class="resize-handle resize-handle-nw"></span>').before('<span class="resize-handle resize-handle-ne"></span>').after('<span class="resize-handle resize-handle-se"></span>').after('<span class="resize-handle resize-handle-sw"></span>'),$("#crop-editor").find(".resize-container").prepend('<button type="button" class="btn-crop-tool flip-x">'+this.icons.flip_x+"</button>").prepend('<button type="button" class="btn-crop-tool flip-y">'+this.icons.flip_y+"</button>").prepend('<button type="button" class="btn-crop-tool invert">'+this.icons.invert+"</button>").prepend('<button type="button" class="btn-crop-tool crop">'+this.icons.crop+"</button>"),this.container=$("#crop-editor .resize-container"));var b=$("#crop-editor .resize-image").get(0);if(1==this.autoSize){var c=this.getProportionalDimensions(a.width,a.height);b.width=c.w,b.height=c.h}else b.width=a.width,b.height=a.height;b.getContext("2d").drawImage(a,0,0,b.width,b.height),this.orig_src.src=b.toDataURL("image/png"),this.image_target=$("#crop-editor .resize-image"),this.image_target.width=a.width,this.image_target.height=a.height;var d=this;return this.container.on("mousedown touchstart",".resize-handle",function(a){d.startResize(a)}),this.container.on("mousedown touchstart","canvas",function(a){d.startMoving(a,d)}),$("#crop-editor .resize-container").hide(),setTimeout(function(){$("#crop-editor .resize-container").show(),this.resizeImage(this.image.resolutions.auto.w,this.image.resolutions.auto.h),this.centerImage(),this.editorBusy(!1),this.cropInit();var a=$(this.imageElement).data("crop-open");a===!0&&this.toggleCrop(!0)}.bind(this),1e3),!0},RoboCrop.prototype.loadImageFromUrl=function(a){this.editorBusy(!0),$("#crop-editor").length&&!$("#crop-editor .current-status").length&&$("#crop-editor").append('<div class="current-status"></div>');var b=this,c=new Image;c.onload=function(){return b.init(c)},c.addEventListener?c.addEventListener("error",function(a){return a.preventDefault(),"Error: crossorigin"}):c.attachEvent("onerror",function(a){return"Error: crossorigin"}),c.setAttribute("crossOrigin","anonymous"),$("#crop-editor .current-status").text("Loading..."),c.src=a},RoboCrop.prototype.editorBusy=function(a){a===!0?$("#crop-editor").hasClass("busy")||$("#crop-editor").addClass("busy"):$("#crop-editor").removeClass("busy")},RoboCrop.prototype.loadImage=function(a){this.editorBusy(!0);var b=a;this.imageElement=$(a).closest(".crop-element"),$("#crop-editor").length&&!$("#crop-editor .current-status").length&&$("#crop-editor").append('<div class="current-status"></div>');var c=this;if(b.files&&b.files[0]){if(!this.validExtension(b.files[0]))return"invalid file Extension";var d=new FileReader;d.onload=function(a){var d=new Image;d.onload=function(){return c.init(d)},d.src=a.target.result,b.value=""},d.readAsDataURL(b.files[0])}},RoboCrop.prototype.dropImage=function(a){this.editorBusy(!0);var b=this;this.imageElement=$(b).closest(".crop-element"),$("#crop-editor").length&&!$("#crop-editor .current-status").length&&$("#crop-editor").append('<div class="current-status"></div>');var c=a.originalEvent.target.files||a.originalEvent.dataTransfer.files;if(c.length>0)if("undefined"!=typeof FileReader&&b.validExtension(c[0])===!0){var d=new FileReader;d.onload=function(a){var c=new Image;c.onload=function(){return b.init(c)},c.src=a.target.result},d.readAsDataURL(c[0])}else this.editorBusy(!1),$("#crop-editor .current-status").text("Invalid image")},RoboCrop.prototype.getProportionalDimensions=function(a,b){var c=new Array;a>this.image.max_width||b>this.image.max_height?this.image.max_width<a?(this.image.resolutions.max.w=this.image.max_width,this.image.resolutions.max.h=c.w/a*b,c.w=this.image.max_width,c.h=c.w/a*b):(this.image.resolutions.max.h=this.image.max_height,this.image.resolutions.max.w=c.h/b*a,c.h=this.image.max_height,c.w=c.h/b*a):(this.image.resolutions.max.w=a,this.image.resolutions.max.h=b,c.w=a,c.h=b);var d=.8;return a>$("#crop-editor").width()||b>$("#crop-editor").height()?(a>$("#crop-editor").width()&&(this.image.resolutions.auto.w=Math.ceil($("#crop-editor").width()*d),this.image.resolutions.auto.h=Math.ceil($("#crop-editor").width()*d/a*b)),b>$("#crop-editor").height()&&(this.image.resolutions.auto.w=Math.ceil($("#crop-editor").height()*d/b*a),this.image.resolutions.auto.h=Math.ceil($("#crop-editor").height()*d))):(this.image.resolutions.auto.w=Math.ceil(a),this.image.resolutions.auto.h=Math.ceil(b)),this.image.resolutions.small.w=Math.ceil(this.image.resolutions.auto.w/2),this.image.resolutions.small.h=Math.ceil(this.image.resolutions.auto.h/2),c},RoboCrop.prototype.saveEventState=function(a,b){this.event_state[b?"crop_area_width":"container_width"]=this[b?"crop_area":"container"].width(),this.event_state[b?"crop_area_height":"container_height"]=this[b?"crop_area":"container"].height(),this.event_state[b?"crop_area_left":"container_left"]=this[b?"crop_area":"container"].offset().left,this.event_state[b?"crop_area_top":"container_top"]=this[b?"crop_area":"container"].offset().top,this.event_state.mouse_x=(a.clientX||a.pageX||a.originalEvent.touches[0].clientX)+$(window).scrollLeft(),this.event_state.mouse_y=(a.clientY||a.pageY||a.originalEvent.touches[0].clientY)+$(window).scrollTop();var c=this;"undefined"!=typeof a.originalEvent.touches&&(this.event_state.touches=[],$.each(a.originalEvent.touches,function(a,b){c.event_state.touches[a]={},c.event_state.touches[a].clientX=0+b.clientX,c.event_state.touches[a].clientY=0+b.clientY})),this.event_state.evnt=a},RoboCrop.prototype.startResize=function(a){a.preventDefault(),a.stopPropagation(),this.saveEventState(a);var b=this;$(document).on("mousemove touchmove",function(a){b.resizing(a)}),$(document).on("mouseup touchend",this.endResize)},RoboCrop.prototype.endResize=function(a){a.preventDefault(),$(document).off("mouseup touchend",this.endResize),$(document).off("mousemove touchmove",this.resizing)},RoboCrop.prototype.startMoving=function(a,b,c){a.preventDefault(),a.stopPropagation();var d=!1;$(a.target).hasClass("resize-crop")&&($(a.target).hasClass("left")&&(d="left"),$(a.target).hasClass("right")&&(d="right"),$(a.target).hasClass("top")&&(d="top"),$(a.target).hasClass("bottom")&&(d="bottom")),b.saveEventState(a,!!c),$(document).on("mousemove touchmove",function(a){b.moving(a,c,d)}),$(document).on("mouseup touchend",this.endMoving)},RoboCrop.prototype.endMoving=function(a){a.preventDefault(),$(document).off("mouseup touchend",this.endMoving),$(document).off("mousemove touchmove",this.moving)},RoboCrop.prototype.cropResize=function(a){var b=$("#crop-editor").find(".crop-area").offset().left,c=$("#crop-editor").find(".resize-container").offset().left,d=$("#crop-editor").find(".crop-area").offset().top,e=$("#crop-editor").find(".resize-container").offset().top,f=$("#crop-editor").find(".crop-area").width(),g=$("#crop-editor").find(".resize-container").width(),h=$("#crop-editor").find(".crop-area").height(),i=$("#crop-editor").find(".resize-container").height(),l=(this.cropValues.width.initial,this.cropValues.height.initial,0);if("left"===a){var m=10;l=b-this.mouse.x+f-m}else if("right"===a){var m=20;l=this.mouse.x-b-m}else if("top"===a){var m=10;l=d-this.mouse.y+h-m}else if("bottom"===a){var m=20;l=this.mouse.y-d-m}if("top"===a||"bottom"===a){if(d<=e&&l>this.cropValues.height.value)return;if(d+h+10>=e+i&&l>this.cropValues.height.value)return}if("left"===a||"right"===a){if(b<=c&&l>this.cropValues.width.value)return;if(b+f+10>=c+g&&l>this.cropValues.width.value)return}"left"===a||"right"===a?this.cropValues.width.value=this.validCropSize(l,this.cropValues.width):this.cropValues.height.value=this.validCropSize(l,this.cropValues.height),this.setCropArea(this.cropValues.width.value,this.cropValues.height.value,this.cropBorder,!0)},RoboCrop.prototype.validCropSize=function(a,b){switch(b.min.operator){case">=":a=a>=b.min.value?a:b.min.value;break;case"<=":a=a<=b.min.value?a:b.min.value;break;case"<":a=a<b.min.value?a:b.min.value;break;case">":a=a>b.min.value?a:b.min.value;break;case"=":a=a==b.min.value?a:b.min.value}switch(b.max.operator){case">=":a=b.max.value===!1||a>=b.max.value?a:b.max.value;break;case"<=":a=b.max.value===!1||a<=b.max.value?a:b.max.value;break;case"<":a=b.max.value===!1||a<b.max.value?a:b.max.value;break;case">":a=b.max.value===!1||a>b.max.value?a:b.max.value;break;case"=":a=b.max.value===!1||a==b.max.value?a:b.max.value}return Math.ceil(a)},RoboCrop.prototype.cropConflict=function(){if(this.cropValues.enabled){var a=$("#crop-editor").find(".crop-area").offset(),b=$("#crop-editor").find(".resize-container").offset();if(void 0==b||void 0==a)return!1;var c={width:$("#crop-editor").find(".crop-area").width(),height:$("#crop-editor").find(".crop-area").height()},d={width:$("#crop-editor").find(".resize-container").width(),height:$("#crop-editor").find(".resize-container").height()},e=12;if(b.top+d.height-e-(a.top+c.height)<=0)return!0;var f=8;if(b.left+d.width-f-(a.left+c.width)<=0)return!0}return!1},RoboCrop.prototype.moving=function(a,b,c){if(a.preventDefault(),a.stopPropagation(),this.touches=a.originalEvent.touches,this.mouse.x=(a.clientX||a.pageX||void 0!==this.touches&&this.touches[0].clientX)+$(window).scrollLeft(),this.mouse.y=(a.clientY||a.pageY||void 0!==this.touches&&this.touches[0].clientY)+$(window).scrollTop(),b&&c)return void this.cropResize(c);var d=b?this.crop_area:this.container,e=b?this.event_state.crop_area_left:this.event_state.container_left,f=b?this.event_state.crop_area_top:this.event_state.container_top,g=b?this.event_state.crop_area_height:this.event_state.container_height,h=b?this.event_state.crop_area_width:this.event_state.container_width,i=this.mouse.y-(this.event_state.mouse_y-f),j=this.mouse.x-(this.event_state.mouse_x-e),k=$("#crop-editor").find(".crop-area").offset(),l=$("#crop-editor").find(".resize-container").offset(),m={width:$("#crop-editor").find(".crop-area").width(),height:$("#crop-editor").find(".crop-area").height()},n={width:$("#crop-editor").find(".resize-container").width(),height:$("#crop-editor").find(".resize-container").height()};if(l.left<=0||l.top<=0?($(".btn-main-menu-action").show(200),$(".btn-crop-tool").hide(200)):($(".btn-main-menu-action").hide(200),$(".btn-crop-tool").show(200)),this.cropValues.enabled&&b){k.top-l.top<=0&&i<=f&&(i=l.top),k.left-l.left<=0&&j<=e&&(j=l.left);var o=12;l.top+n.height-o-(k.top+m.height)<=0&&i+m.height>l.top+n.height-o&&(i=l.top-o+(n.height-m.height));var p=8;l.left+n.width-p-(k.left+m.width)<=0&&j+m.width>l.left+n.width-p&&(j=l.left-p+(n.width-m.width))}if(d.offset({left:j,top:i}),this.event_state.touches&&this.event_state.touches.length>1&&this.touches.length>1){var q=h,r=g,s=this.event_state.touches[0].clientX-this.event_state.touches[1].clientX;s*=s;var t=this.event_state.touches[0].clientY-this.event_state.touches[1].clientY;t*=t;var u=Math.sqrt(s+t);s=a.originalEvent.touches[0].clientX-this.touches[1].clientX,s*=s,t=a.originalEvent.touches[0].clientY-this.touches[1].clientY,t*=t;var v=Math.sqrt(s+t),w=v/u;q*=w,r*=w,b!==!0&&(this.resizeImage(q,r),this.setChangesStateOn(!0))}},RoboCrop.prototype.resizing=function(a){if(this.offset=this.container.offset(),this.mouse.x=(a.clientX||a.pageX||void 0!==a.originalEvent.touches&&a.originalEvent.touches[0].clientX)+$(window).scrollLeft(),this.mouse.y=(a.clientY||a.pageY||void 0!==a.originalEvent.touches&&a.originalEvent.touches[0].clientY)+$(window).scrollTop(),$(this.event_state.evnt.target).hasClass("resize-handle-se")?(this.width=this.mouse.x-this.event_state.container_left,this.height=this.mouse.y-this.event_state.container_top,this.left=this.event_state.container_left,this.top=this.event_state.container_top):$(this.event_state.evnt.target).hasClass("resize-handle-sw")?(this.width=this.event_state.container_width-(this.mouse.x-this.event_state.container_left),this.height=this.mouse.y-this.event_state.container_top,this.left=this.mouse.x,this.top=this.event_state.container_top):$(this.event_state.evnt.target).hasClass("resize-handle-nw")?(this.width=this.event_state.container_width-(this.mouse.x-this.event_state.container_left),this.height=this.event_state.container_height-(this.mouse.y-this.event_state.container_top),this.left=this.mouse.x,this.top=this.mouse.y,(this.constrain||a.shiftKey)&&(this.top=this.mouse.y-(this.width/this.orig_src.width*this.orig_src.height-this.height))):$(this.event_state.evnt.target).hasClass("resize-handle-ne")&&(this.width=this.mouse.x-this.event_state.container_left,this.height=this.event_state.container_height-(this.mouse.y-this.event_state.container_top),this.left=this.event_state.container_left,this.top=this.mouse.y,(this.constrain||a.shiftKey)&&(this.top=this.mouse.y-(this.width/this.orig_src.width*this.orig_src.height-this.height))),(this.constrain||a.shiftKey)&&(this.height=this.width/this.orig_src.width*this.orig_src.height),this.width>0&&this.height>0){var b=8,c=$("#crop-editor").find(".crop-area").offset(),d=$("#crop-editor").find(".resize-container").offset(),e={width:$("#crop-editor").find(".crop-area").width(),height:$("#crop-editor").find(".crop-area").height()};({width:$("#crop-editor").find(".resize-container").width(),height:$("#crop-editor").find(".resize-container").height()});if(this.cropValues.enabled){if(this.width+d.left-b<=c.left+e.width)return;if(this.height+d.top-b<=c.top+e.height)return}this.resizeImage(this.width,this.height),this.container.offset({left:this.left,top:this.top})}$("#crop-editor .current-status").text(this.getImageSize().w+"x"+this.getImageSize().h)},RoboCrop.prototype.getImageSize=function(){var a=new Array;return a.w=void 0!==$("#crop-editor .resize-image").attr("width")?$("#crop-editor .resize-image").attr("width"):0,a.h=void 0!==$("#crop-editor .resize-image").attr("height")?$("#crop-editor .resize-image").attr("height"):0,a},RoboCrop.prototype.resizeImage=function(a,b){a=Math.ceil(a),b=Math.ceil(b),this.resize_canvas.width=a,this.resize_canvas.height=b,this.resize_canvas.getContext("2d").drawImage(this.orig_src,0,0,a,b),this.image_target.width=a,this.image_target.height=b,$("#crop-editor .resize-image").attr("width",Math.ceil(a)),$("#crop-editor .resize-image").attr("height",Math.ceil(b)),this.image_target.get(0).getContext("2d").drawImage(this.resize_canvas,0,0),$("#crop-editor .current-status").text(this.getImageSize().w+"x"+this.getImageSize().h),this.cropConflict()&&($("#crop-editor").find(".crop-area").remove(),this.cropValues.enabled=!1)},RoboCrop.prototype.setCropArea=function(a,b,c,d){if(a>$("#crop-editor").find(".resize-container").width()||b>$("#crop-editor").find(".resize-container").height())return this.cropValues.enabled=!1,void $("#crop-editor .current-status").text("Picture is too small to be cropped.");if(c="undefined"==typeof c?4:c,this.cropBorder=c,this.cropValues.width.value=a,this.cropValues.height.value=b,d===!0){var e=0;a+=e,b+=e,$("#crop-editor").find(".resize-container .crop-area").length||$("#crop-editor").find(".resize-container").prepend('<div class="crop-area"><span class="crop-size">200x200</span><span class="resize-crop top"></span><span class="resize-crop bottom"></span><span class="resize-crop left"></span><span class="resize-crop right"></span></div>'),$("#crop-editor").find(".crop-area").removeClass("resize-w"),$("#crop-editor").find(".crop-area").removeClass("resize-h"),this.cropValues.width.resize&&$("#crop-editor").find(".crop-area").addClass("resize-w"),this.cropValues.height.resize&&$("#crop-editor").find(".crop-area").addClass("resize-h"),$("#crop-editor .crop-area").css({width:this.cropValues.width.value+2*this.cropBorder,height:this.cropValues.height.value+2*this.cropBorder,"margin-left":-1*((this.cropValues.width.value+2*this.cropBorder)/2),"margin-top":-1*((this.cropValues.height.value+2*this.cropBorder)/2)}),$("#crop-editor").find(".crop-size").text(this.cropValues.width.value+"x"+this.cropValues.height.value)}},RoboCrop.prototype.centerImage=function(){var a=$("#crop-editor").offset().left+($("#crop-editor").width()/2-this.container.width()/2),b=$("#crop-editor").height()/2-$("#crop-editor .resize-container").height()/2;this.container.animate({left:a,top:b},10)},RoboCrop.prototype.flipX=function(){this.editorBusy(!0),setTimeout(function(){var a=this.image_target.width,b=this.image_target.height;this.resizeImage(this.image.resolutions.max.w,this.image.resolutions.max.h);var c=this.image_target.get(0).getContext("2d"),d=c.canvas.width,e=c.canvas.height;c.clearRect(0,0,d,e),c.save(),c.scale(-1,1),c.drawImage(this.orig_src,d*-1,0,d,e),c.restore(),this.orig_src.src=this.image_target.get(0).toDataURL("image/png"),this.resizeImage(a,b),this.editorBusy(!1)}.bind(this),10)},RoboCrop.prototype.flipY=function(){this.editorBusy(!0),setTimeout(function(){var a=this.image_target.width,b=this.image_target.height;this.resizeImage(this.image.resolutions.max.w,this.image.resolutions.max.h);var c=this.image_target.get(0).getContext("2d"),d=c.canvas.width,e=c.canvas.height;c.clearRect(0,0,d,e),c.save(),c.scale(1,-1),c.drawImage(this.orig_src,0,e*-1,d,e),c.restore(),this.orig_src.src=this.image_target.get(0).toDataURL("image/png"),this.resizeImage(a,b),this.editorBusy(!1)}.bind(this),10)},RoboCrop.prototype.invertDimensions=function(){var a=this.image_target.get(0).getContext("2d"),b=a.canvas.width,c=a.canvas.height;this.resizeImage(c,b),this.centerImage()},RoboCrop.prototype.crop=function(){this.image.cropped=!0;var a,b=$("#crop-editor .crop-area").offset().left-this.container.offset().left,c=$("#crop-editor .crop-area").offset().top-this.container.offset().top,d=$("#crop-editor .crop-area").width(),e=$("#crop-editor .crop-area").height();a=document.createElement("canvas"),a.width=d,a.height=e,a.getContext("2d").drawImage(this.image_target.get(0),b+this.cropBorder,c+this.cropBorder,d,e,0,0,d,e),this.orig_src.src=a.toDataURL("image/png"),$("#crop-editor .resize-image").get(0).getContext("2d").clearRect(0,0,$("#crop-editor .resize-image").width(),$("#crop-editor .resize-image").height()),d=Math.ceil(d),e=Math.ceil(e),this.resize_canvas.width=d,this.resize_canvas.height=e,this.image_target.width=d,this.image_target.height=e,$("#crop-editor .resize-image").attr("width",d),$("#crop-editor .resize-image").attr("height",e),this.centerImage(),this.image_target.get(0).getContext("2d").drawImage(a,0,0),$("#crop-editor .current-status").text(this.getImageSize().w+"x"+this.getImageSize().h)},RoboCrop.prototype.getImageBase64=function(a){return!!$("#crop-editor .resize-container").length&&(("png"===a||"jpeg"===a||"jpg"===a||"gif"===a||"bmp"===a)&&(void 0!==this.image_target&&this.image_target.get(0).toDataURL("image/"+a)))},RoboCrop.prototype.clearImage=function(){void 0!==$("#crop-editor .resize-image").get(0)&&($("#crop-editor .resize-image").get(0).getContext("2d").clearRect(0,0,$("#crop-editor .resize-image").width(),$("#crop-editor .resize-image").height()),this.orig_src.src=$("#crop-editor .resize-image").get(0).toDataURL("image/png")),$("#crop-editor .resize-container").remove(),$("#crop-editor .current-status").text("")},RoboCrop.prototype.addWatermark=function(a){this.busy(!0),void 0==a.margin_top&&(a.margin_top=0),void 0==a.margin_right&&(a.margin_right=0),void 0==a.margin_bottom&&(a.margin_bottom=0),void 0==a.margin_left&&(a.margin_left=0),void 0==a.opacity&&(a.opacity=1);var b=this,c=new Image;c.onload=function(){var d=b.image_target.get(0).getContext("2d"),e=$("#crop-editor .resize-image").get(0),f=e.width,g=e.height;d.save();var h=a.margin_left-a.margin_right,i=a.margin_top-a.margin_bottom;switch(d.globalAlpha=a.opacity,a.position){case"top-left":d.drawImage(c,0+a.margin_x,0+i);break;case"bottom-left":d.drawImage(c,0+h,g-c.height+i);break;case"top-right":d.drawImage(c,f-c.width+h,0+i);break;case"center":d.drawImage(c,f/2-c.width/2+h,g/2-c.height/2+i);break;case"bottom-right":d.drawImage(c,f-c.width+h,g-c.height+i);break;default:d.drawImage(c,f-c.width+h,g-c.height+i)}d.restore();var j=$(b.imageElement).data("ext");j=b.validExtension(j?j:"png"),b.orig_src.src=b.image_target.get(0).toDataURL("image/"+j),b.apply(b.orig_src.src)},c.addEventListener?c.addEventListener("error",function(a){return a.preventDefault(),"Error: crossorigin"}):c.attachEvent("onerror",function(a){return"Error: crossorigin"}),c.setAttribute("crossOrigin","anonymous"),c.src=a.file},RoboCrop.prototype.uploadPicture=function(a,b){var c=this,d=new FormData;d.append("picture",JSON.stringify(a));var e=new XMLHttpRequest;if(this.events.upload.before){var f=this.events.upload.before(a);$.each(f,function(a,b){d.append(b.name,b.value)})}e.onreadystatechange=function(){if(4==e.readyState){try{var a=JSON.parse(e.response)}catch(b){a=!1}c.events.upload.end!==!1&&c.events.upload.end(a)}};var g=function(b){c.events.upload.progress!==!1&&c.events.upload.progress(a,b.loaded,b.total)};e.addEventListener("progress",g,!1),e.upload.addEventListener("progress",g,!1),e.open("POST",b),e.send(d)},RoboCrop.prototype.apply=function(a){$("html,body,#crop-editor").css("overflow","initial"),this.busy(!0);var b=$(this.imageElement).data("ext");b=this.validExtension(b?b:"png");var c=void 0===a?this.getImageBase64(b):a,d=c.substring("data:image/".length,c.indexOf(";base64"));
b="png"===d?d:$(this.imageElement).data("ext"),$(this.imageElement).find("img").first().attr("src",c);var e=$(this.imageElement).data("name");e=void 0===e?"crop_image":e,$(this.imageElement).find("input[type=hidden]").length||$(this.imageElement).append('<input type="hidden" name="'+e+'" value=""/>'),$(this.imageElement).find("input[type=hidden]").val(c);var f=$(this.imageElement).data("imagename");f=void 0===f?"":f;var g=$(this.imageElement).data("upload"),h=this.getImageSize(),i="data:image/png;base64,",j=Math.round(3*(c.length-i.length)/4);if(void 0!==g){var k={name:e,imagename:f,ext:b,width:h.w,height:h.h,size:j,data:c};this.uploadPicture(k,g)}this.clearImage(),this.busy(!1),$(this.imageElement).addClass("not-empty"),this.events.apply&&this.events.apply({name:e,imagename:f,ext:b,width:h.w,height:h.h,size:j,data:c})};var robocrop=new RoboCrop;$(".crop-element").each(function(){var a=$(this).closest(".crop-element").find("img").attr("src");void 0!==a&&a.length<=0&&$(this).addClass("not-empty")}),$(document).on("click",".btn-crop-tool.flip-x,.btn-main-menu-action.flip-x",function(){robocrop.flipX()}),$(document).on("click",".btn-crop-tool.flip-y,.btn-main-menu-action.flip-y",function(){robocrop.flipY()}),$(document).on("click",".btn-crop-tool.invert,.btn-main-menu-action.invert",function(){robocrop.invertDimensions()}),$(document).on("click",".btn-crop-tool.crop,.btn-main-menu-action.crop",function(){robocrop.toggleCrop()}),$(document).on("click",".crop-element .edit",function(a){a.preventDefault(),a.stopPropagation();var b=$(this).closest(".crop-element").find("img").attr("src");if(void 0!==b&&b.length>0){var c=b.split("\\").pop(),d=c.split(".").pop();robocrop.validExtension(d)&&$(this).closest(".crop-element").data("imagename",c),robocrop.clearImage(),robocrop.imageElement=$(this).closest(".crop-element"),robocrop.loadImageFromUrl(b),$("#crop-editor").addClass("open")}}),$("#crop-editor").on("dragover",function(a){a.stopPropagation(),a.preventDefault()}),$("#crop-editor").on("drop",function(a){a.stopPropagation(),a.preventDefault();var b=a.originalEvent.target.files||a.originalEvent.dataTransfer.files,c=b.length>0&&b[0];if(c){var d=c.name.split(".").pop();robocrop.validExtension(d,!0)?($(this).closest(".crop-element").data("imagename",c.name),robocrop.toggleCrop(!1),robocrop.clearImage(),robocrop.dropImage(a)):$("#crop-editor .current-status").text("Invalid image")}}),$(document).on("click","#crop-editor.busy",function(a){a.preventDefault(),a.stopPropagation()}),$(document).on("click","#crop-editor .image-resolutions .img-max",function(){robocrop.resizeImage(robocrop.image.resolutions.max.w,robocrop.image.resolutions.max.h),robocrop.centerImage()}),$(document).on("click","#crop-editor .image-resolutions .img-auto",function(){robocrop.resizeImage(robocrop.image.resolutions.auto.w,robocrop.image.resolutions.auto.h),robocrop.centerImage()}),$(document).on("click","#crop-editor .image-resolutions .img-small",function(){robocrop.resizeImage(robocrop.image.resolutions.small.w,robocrop.image.resolutions.small.h),robocrop.centerImage()}),$(document).on("click",".crop-element.busy",function(a){a.preventDefault(),a.stopPropagation()}),$(document).on("click","#crop-editor .editor-main-menu .cancel",function(){robocrop.clearImage(),$("html,body,#crop-editor").css("overflow","initial"),$("#crop-editor").removeClass("open")}),$(document).on("change",".crop-element input:file",function(){var a=$(this).val().split("\\").pop(),b=a.split(".").pop();robocrop.validExtension(b)&&$(this).closest(".crop-element").data("imagename",a),robocrop.clearImage(),robocrop.loadImage(this),$("#crop-editor").addClass("open")}),$(document).on("click","#crop-editor .editor-main-menu .apply",function(){robocrop.cropValues.enabled&&(robocrop.crop(),robocrop.toggleCrop(!1));var a=$(robocrop.imageElement).data("crop-required"),b=$("#crop-editor .resize-image").width(),c=$("#crop-editor .resize-image").height(),d=robocrop.validCropSize(b,robocrop.cropValues.width),e=robocrop.validCropSize(c,robocrop.cropValues.height);if(a===!0&&(b!=d||c!=e))return void $("#crop-editor .current-status").text("RoboCrop is required");var f=$(robocrop.imageElement).data("watermark");void 0!==name&&void 0!==robocrop.watermarks[f]?robocrop.addWatermark(robocrop.watermarks[f]):robocrop.apply(),$("#crop-editor").removeClass("open")}),$("#crop-editor").bind("mousewheel",function(a){if(!$("#crop-editor").hasClass("busy")){var b=parseInt(robocrop.getImageSize().w),c=parseInt(robocrop.getImageSize().h);a.originalEvent.wheelDelta/120>0?robocrop.resizeImage(b+robocrop.image.zoom.speed,c+robocrop.image.zoom.speed):b-robocrop.image.zoom.speed>50&&c-robocrop.image.zoom.speed>50&&robocrop.resizeImage(b-robocrop.image.zoom.speed,c-robocrop.image.zoom.speed),robocrop.centerImage()}}),$("#crop-editor").bind("DOMMouseScroll",function(a){if(!$("#crop-editor").hasClass("busy")){var b=parseInt(robocrop.getImageSize().w),c=parseInt(robocrop.getImageSize().h);return a.originalEvent.detail>0?robocrop.resizeImage(b+robocrop.image.zoom.speed,c+robocrop.image.zoom.speed):b-robocrop.image.zoom.speed>50&&c-robocrop.image.zoom.speed>50&&robocrop.resizeImage(b-robocrop.image.zoom.speed,c-robocrop.image.zoom.speed),robocrop.centerImage(),!1}});
